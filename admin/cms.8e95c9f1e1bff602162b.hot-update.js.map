{"version":3,"file":"cms.8e95c9f1e1bff602162b.hot-update.js","sources":["webpack:///./src/templates/BlogIndex.js"],"sourcesContent":["import React from 'react'\nimport { graphql } from 'gatsby'\nimport { Location } from '@reach/router'\nimport qs from 'qs'\n\nimport PageHeader from '../components/PageHeader'\nimport PostSection from '../components/PostSection'\n//import PostCategoriesNav from '../components/PostCategoriesNav'\nimport Layout from '../components/Layout'\n\n/**\n * Filter posts by date. Feature dates will be fitered\n * When used, make sure you run a cronejob each day to show schaduled content. See docs\n *\n * @param {posts} object\n */\nexport const byDate = posts => {\n  const now = Date.now()\n  return posts.filter(post => Date.parse(post.date) <= now)\n}\n\n/**\n * filter posts by category.\n *\n * @param {posts} object\n * @param {title} string\n * @param {contentType} string\n */\nexport const byCategory = (posts, title, contentType) => {\n  const isCategory = contentType === 'postCategories'\n  const byCategory = post =>\n    post.categories &&\n    post.categories.filter(cat => cat.category === title).length\n  return isCategory ? posts.filter(byCategory) : posts\n}\n\n// Export Template for use in CMS preview\nexport const BlogIndexTemplate = ({\n  title,\n  subtitle,\n  featuredImage,\n  posts = [],\n  postCategories = [],\n  enableSearch = true,\n  contentType\n}) => (\n  <Location>\n    {({ location }) => {\n      let filteredPosts =\n        posts && !!posts.length\n          ? byCategory(byDate(posts), title, contentType)\n          : []\n\n      let queryObj = location.search.replace('?', '')\n      queryObj = qs.parse(queryObj)\n\n      if (enableSearch && queryObj.s) {\n        const searchTerm = queryObj.s.toLowerCase()\n        filteredPosts = filteredPosts.filter(post =>\n          post.frontmatter.title.toLowerCase().includes(searchTerm)\n        )\n      }\n\n      return (\n        <main className=\"Blog\">\n          <PageHeader\n            title={title}\n            subtitle={subtitle}\n            backgroundImage={featuredImage}\n          />\n\n          {!!postCategories.length && (\n            <section className=\"section thin\">\n              <div className=\"container\">\n                {/* <PostCategoriesNav enableSearch categories={postCategories} /> */}\n              </div>\n            </section>\n          )}\n\n          {!!posts.length && (\n            <section className=\"section\">\n              <div className=\"container\">\n                <PostSection posts={filteredPosts} />\n              </div>\n            </section>\n          )}\n        </main>\n      )\n    }}\n  </Location>\n)\n\n// Export Default BlogIndex for front-end\nconst BlogIndex = ({ data: { page, posts, postCategories } }) => (\n  <Layout\n    meta={page.frontmatter.meta || false}\n    title={page.frontmatter.title || false}\n  >\n    <BlogIndexTemplate\n      {...page}\n      {...page.fields}\n      {...page.frontmatter}\n      posts={posts.edges.map(post => ({\n        ...post.node,\n        ...post.node.frontmatter,\n        ...post.node.fields\n      }))}\n      postCategories={postCategories.edges.map(post => ({\n        ...post.node,\n        ...post.node.frontmatter,\n        ...post.node.fields\n      }))}\n    />\n  </Layout>\n)\n\nexport default BlogIndex\n\nexport const pageQuery = graphql`\n  ## Query for BlogIndex data\n  ## Use GraphiQL interface (http://localhost:8000/___graphql)\n  ## $id is processed via gatsby-node.js\n  ## query name must be unique to this file\n  query BlogIndex($id: String!) {\n    page: markdownRemark(id: { eq: $id }) {\n      ...Meta\n      fields {\n        contentType\n      }\n      frontmatter {\n        title\n        excerpt\n        template\n        subtitle\n        featuredImage\n      }\n    }\n\n    posts: allMarkdownRemark(\n      filter: { fields: { contentType: { eq: \"posts\" } } }\n      sort: { order: DESC, fields: [frontmatter___date] }\n    ) {\n      edges {\n        node {\n          excerpt\n          fields {\n            slug\n          }\n          frontmatter {\n            title\n            date\n            categories {\n              category\n            }\n            featuredImage\n          }\n        }\n      }\n    }\n    postCategories: allMarkdownRemark(\n      filter: { fields: { contentType: { eq: \"postCategories\" } } }\n      sort: { order: ASC, fields: [frontmatter___title] }\n    ) {\n      edges {\n        node {\n          fields {\n            slug\n          }\n          frontmatter {\n            title\n          }\n        }\n      }\n    }\n  }\n`\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;AAMA;AACA;AACA;AAAA;AAAA;AACA;AAEA;;;;;;;;AAOA;AACA;AACA;AAAA;AAAA;AAEA;AAAA;AAFA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAnDA;AACA;AAuDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAKA;AAAA;AAAA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AALA;AACA;AAsBA;AAAA;AAEA;;;;;;;;;;AAtGA;AAYA;AASA;AAwDA;AAyBA;;;;;;;;;;;;;;;;;A","sourceRoot":""}